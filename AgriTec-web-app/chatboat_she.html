<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AgriTec Vision ‚Äî Full Portal (Schemes, Chatbot, Voice, Chart)</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root{--green:#1b5e20;--accent:#43a047;--muted:#6b7280;--card:#fff;--bg:#f4faf4}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,"Segoe UI",Roboto,Arial;margin:0;background:var(--bg);color:#072b1f}
  header{background:linear-gradient(90deg,var(--green),#2e7d32);color:white;padding:20px 18px}
  header h1{margin:0;font-size:1.4rem}
  .container{max-width:1200px;margin:20px auto;padding:16px}
  main{display:grid;grid-template-columns:1.6fr .9fr;gap:18px}
  @media(max-width:980px){main{grid-template-columns:1fr}}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(10,30,20,0.06)}
  .scheme{border-left:5px solid var(--green);padding:12px;margin-bottom:12px;border-radius:8px;background:#fff}
  .scheme h3{margin:0 0 6px;color:var(--green);cursor:pointer}
  .meta{color:var(--muted);font-size:0.95rem}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
  button.btn{background:var(--accent);color:white;padding:8px 12px;border:none;border-radius:8px;cursor:pointer}
  a.link{color:var(--green);font-weight:600;text-decoration:none}
  .details{display:none;margin-top:10px;padding-top:10px;border-top:1px dashed #eef6ee}
  .step{background:#f7fff7;padding:10px;border-radius:8px;margin-bottom:8px}
  .label{font-weight:700;color:#184d35}
  /* Right column */
  .right-col{display:flex;flex-direction:column;gap:12px}
  .chart-wrap{text-align:center;padding:8px}
  canvas{background:#fff;border-radius:8px;padding:8px;max-width:100%}
  /* Chatbot */
  .chatbot{display:flex;flex-direction:column;height:520px}
  .chat-log{flex:1;overflow:auto;padding:10px;background:#fbfffb;border-radius:8px;border:1px solid #eef7ef}
  .msg{margin:8px 0;padding:8px 10px;border-radius:10px;max-width:80%}
  .msg.user{background:#e6f4ea;margin-left:auto}
  .msg.bot{background:#eef7f0;margin-right:auto}
  .chat-controls{display:flex;gap:8px;margin-top:8px;align-items:center}
  input[type="text"],select{padding:8px;border-radius:8px;border:1px solid #e5e7eb;width:100%}
  #mic{background:#4caf50;border:none;color:white;padding:8px;border-radius:50%;cursor:pointer}
  footer{margin-top:18px;text-align:center;color:var(--muted);padding:10px}
  .project-card{background:linear-gradient(180deg,#f1fff1,#ffffff);border-left:6px solid var(--green);padding:12px;border-radius:8px}
  .lang-toggle{display:flex;gap:8px;align-items:center}
  .kbd{font-family:monospace;background:#f3f4f6;padding:2px 6px;border-radius:4px}
</style>
</head>
<body>
<header>
  <div class="container">
    <h1>AgriTec Vision ‚Äî Central & State Agriculture Schemes</h1>

  </div>
</header>

<div class="container">
  <main>
    <!-- Left: Schemes -->
    <section>
      <div class="card">
        <h2 style="margin-top:0">Central Government Schemes (Major)</h2>

        <!-- We'll include many schemes. Each article has English + Kannada details in dataset below -->
        <!-- Schemes are rendered by JS from a local data array for maintainability -->
        <div id="schemesContainer"></div>

        <hr />
        <h2 style="margin-top:10px">State Schemes (Representative)</h2>
        <div id="stateSchemesContainer"></div>

        <hr />
        <div style="display:flex;gap:10px;align-items:center">
          <div class="project-card" style="flex:1">
            <strong>AgriTec Vision ‚Äî Project</strong>
            <p style="margin:6px 0 0;color:var(--muted)">Static demo with offline chatbot & voice. To keep live, connect a backend and update the local data file.</p>
          </div>
          <button class="btn" id="refreshCounts">Update Chart</button>
        </div>

      </div>
    </section>

    <!-- Right: Chart + Chatbot -->
    <aside class="right-col">

      <div class="card chart-wrap">
        <h3 style="margin-top:0">Schemes Overview</h3>
        <canvas id="overviewChart" width="360" height="260"></canvas>
        <div style="font-size:0.9rem;color:var(--muted);margin-top:8px">Counts by category. Click <span class="kbd">Update Chart</span> after changes.</div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px">Multilingual Chatbot (Offline)</h3>

        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px" class="lang-toggle">
          <label for="botLang">Language:</label>
          <select id="botLang" aria-label="Language">
            <option value="en" selected>English</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
            <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
          </select>
          <div style="margin-left:auto;color:var(--muted);font-size:0.9rem">Voice: speech recognition & TTS</div>
        </div>

        <div class="chatbot card" style="padding:10px">
          <div id="chatLog" class="chat-log"></div>
          <div class="chat-controls">
            <button id="mic">üé§</button>
            <input type="text" id="userMsg" placeholder="Type or speak your question about schemes..." />
            <button id="send">Send</button>
          </div>
          <div style="margin-top:8px;color:var(--muted);font-size:0.9rem">
            Tip: click any scheme title to ask the bot about it automatically.
          </div>
        </div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px">Quick Links</h4>
        <ul style="margin:0;padding-left:18px;color:var(--muted)">
          <li><a class="link" href="https://pmkisan.gov.in/" target="_blank">PM-KISAN</a></li>
          <li><a class="link" href="https://pmfby.gov.in/" target="_blank">PMFBY</a></li>
          <li><a class="link" href="https://soilhealth.dac.gov.in/" target="_blank">Soil Health Card</a></li>
          <li><a class="link" href="https://enam.gov.in/web/" target="_blank">e-NAM</a></li>
        </ul>
      </div>

    </aside>
  </main>

  <footer>¬© AgriTec Vision ‚Ä¢ Demo. For production, keep data updated with official sources.</footer>
</div>

<script>
/* ======================================================
   Data: Central and State schemes (English + Kannada)
   You can extend this array or load from json file.
   ====================================================== */
const CENTRAL_SCHEMES = [
  {
    id: 'pmkisan',
    name: 'PM-KISAN (Pradhan Mantri Kisan Samman Nidhi)',
    en: {
      short: 'Direct income support ‚Äî ‚Çπ6,000 per year (3 installments).',
      how: 'Visit the PM-KISAN portal ‚Üí Farmers Corner ‚Üí New Farmer Registration. Fill Aadhaar & bank details.',
      docs: ['Aadhaar card','Bank passbook (first page)','Land records (if requested)'],
      link: 'https://pmkisan.gov.in/'
    },
    kn: {
      short: '‡≤®‡≥á‡≤∞ ‡≤Ü‡≤¶‡≤æ‡≤Ø ‡≤∏‡≤π‡≤æ‡≤Ø ‚Äî ‡≤µ‡≤∞‡≥ç‡≤∑‡≤ï‡≥ç‡≤ï‡≥Ü ‚Çπ6,000 (3 ‡≤π‡≤Ç‡≤§‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø).',
      how: 'PM-KISAN ‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≤≤‡≥ç ‚Üí Farmers Corner ‚Üí New Farmer Registration ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø. ‡≤Ü‡≤ß‡≤æ‡≤∞‡≥ç ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤µ‡≤ø‡≤µ‡≤∞ ‡≤π‡≤æ‡≤ï‡≤ø.',
      docs: ['‡≤Ü‡≤ß‡≤æ‡≤∞‡≥ç ‡≤ï‡≤æ‡≤∞‡≥ç‡≤°‡≥ç','‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤™‡≤æ‡≤∏‡≥ç‚Äå‡≤¨‡≥Å‡≤ï‡≥ç (‡≤Æ‡ØÅ‡Æ§‡Æ≤‡Øç ‡≤™‡≥Å‡≤ü)','‡≤≠‡≥Ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü (‡≤Ö‡≤ó‡≤§‡≥ç‡≤Ø‡≤µ‡≤ø‡≤¶‡≥ç‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø)'],
      link: 'https://pmkisan.gov.in/'
    }
  },
  {
    id: 'pmfby',
    name: 'PMFBY (Pradhan Mantri Fasal Bima Yojana)',
    en: {
      short: 'Crop insurance to protect against natural calamities, pests & diseases.',
      how: 'Enroll via local agriculture office, bank, or authorised vendor during enrollment period.',
      docs: ['Farmer ID / Aadhaar','Bank account','Crop & land details'],
      link: 'https://pmfby.gov.in/'
    },
    kn: {
      short: '‡≤™‡≥ç‡≤∞‡≤æ‡≤ï‡≥É‡≤§‡≤ø‡≤ï ‡≤µ‡≤ø‡≤™‡≤§‡≥ç‡≤§‡≥Å, ‡≤ï‡≥Ä‡≤ü ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∞‡≥ã‡≤ó‡≤ó‡≤≥‡≤ø‡≤Ç‡≤¶ ‡≤∞‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≤≤‡≥Å ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤µ‡≤ø‡≤Æ‡≥Ü.',
      how: '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤ï‡≥É‡≤∑‡≤ø ‡≤ï‡≤ö‡≥á‡≤∞‡≤ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≤ø‡≤® ‡≤Æ‡≥Ç‡≤≤‡≤ï ‡≤¶‡≤æ‡≤ñ‡≤≤‡≤æ‡≤§‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø.',
      docs: ['‡≤∞‡≥à‡≤§ ID / ‡≤Ü‡≤ß‡≤æ‡≤∞‡≥ç','‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤ñ‡≤æ‡≤§‡≥Ü','‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤≠‡≥Ç ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø'],
      link: 'https://pmfby.gov.in/'
    }
  },
  {
    id: 'pmksy',
    name: 'PMKSY (Pradhan Mantri Krishi Sinchai Yojana)',
    en: {
      short: 'Irrigation coverage & water-use efficiency program.',
      how: 'Contact state PMKSY implementing agency / district irrigation office for scheme-specific forms.',
      docs: ['Land records','Scheme specific documents'],
      link: 'https://pmksy.gov.in/'
    },
    kn: {
      short: '‡≤®‡≥Ä‡≤∞‡≥Å ‡≤µ‡≥ç‡≤Ø‡≤Ø‡≤¶ ‡≤™‡≤∞‡≤ø‡≤£‡≤æ‡≤Æ‡≤ï‡≤æ‡≤∞‡≤ø‡≤§‡≥ç‡≤µ ‡≤π‡≤æ‡≤ó‡≥Ç ‡≤®‡≥Ä‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤µ‡≤ø‡≤∏‡≥ç‡≤§‡≤∞‡≤£‡≥Ü ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü.',
      how: '‡≤∞‡≤æ‡≤ú‡≥ç‡≤Ø PMKSY ‡≤ú‡≤æ‡≤∞‡≤ø‡≤ó‡≤æ‡≤∞‡≤∞riques / ‡≤ú‡≤ø‡≤≤‡≥ç‡≤≤‡≥Ü ‡≤®‡≤ø‡≥ï‡≤∞‡≤æ‡≤µ‡≤∞‡≤ø ‡≤ï‡≤ö‡≥á‡≤∞‡≤ø‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø.',
      docs: ['‡≤≠‡≥Ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü','‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å'],
      link: 'https://pmksy.gov.in/'
    }
  },
  {
    id: 'soilhealth',
    name: 'Soil Health Card Scheme',
    en: {
      short: 'Soil testing & nutrient recommendations for improved yields.',
      how: 'Collect soil samples per local guidelines and submit at Soil Testing Lab; get SHC with recommendations.',
      docs: ['Sample forms','Farmer ID / land details as required'],
      link: 'https://soilhealth.dac.gov.in/'
    },
    kn: {
      short: '‡≤Æ‡≤£‡≥ç‡≤£‡≥Å ‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≥Ü ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤™‡≥ã‡≤∑‡≤ï‡≤æ‡≤Ç‡≤∂ ‡≤∂‡≤ø‡≤´‡≤æ‡≤∞‡≤∏‡≥ç‡≤∏‡≥Å‡≤ó‡≤≥‡≥Å.',
      how: '‡≤Æ‡≤£‡≥ç‡≤£‡≤ø‡≤® ‡≤Æ‡≤æ‡≤¶‡≤∞‡≤ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤Ç‡≤ó‡≥ç‡≤∞‡≤π‡≤ø‡≤∏‡≤ø ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≤æ ‡≤ï‡≥á‡≤Ç‡≤¶‡≥ç‡≤∞‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø; SHC ‡≤™‡≤°‡≥Ü‡≤Ø‡≤ø‡≤∞‡≤ø.',
      docs: ['‡≤∏‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤™‡≤≤‡≥ç ‡≤´‡≤æ‡≤∞‡≤Ç','‡≤∞‡≥à‡≤§ ID / ‡≤≠‡≥Ç ‡≤µ‡≤ø‡≤µ‡≤∞'],
      link: 'https://soilhealth.dac.gov.in/'
    }
  },
  {
    id: 'enam',
    name: 'e-NAM (National Agriculture Market)',
    en: {
      short: 'Online trading platform connecting mandis to improve price realization.',
      how: 'Register as farmer/trader on e-NAM via your mandi or the portal.',
      docs: ['Identity','Bank details','Mandi registration documents'],
      link: 'https://enam.gov.in/web/'
    },
    kn: {
      short: '‡≤Æ‡≤Ç‡≤°‡≤ø‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤Ü‡≤®‡≥ç‡≤≤‡≥à‡≤®‡≥ç ‡≤Æ‡≥Ç‡≤≤‡≤ï ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≥Å‡≤µ ‡≤ï‡≥É‡≤∑‡≤ø ‡≤Æ‡≤æ‡≤∞‡≥Å‡≤ï‡≤ü‡≥ç‡≤ü‡≥Ü.',
      how: 'e-NAM ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∞‡≥à‡≤§‡≤µ‡≤æ‡≤ó‡≤ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤µ‡≥ç‡≤Ø‡≤æ‡≤™‡≤æ‡≤∞‡≤ø ‡≤Ü‡≤ó‡≤ø ‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø (‡≤Æ‡≤Ç‡≤°‡≤ø ‡≤Æ‡≥Ç‡≤≤‡≤ï ‡≤∏‡≤π ‡≤ñ‡≤æ‡≤§‡≥Ü ‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß‡≤™‡≤°‡≤ø‡≤∏‡≤¨‡≤π‡≥Å‡≤¶‡≥Å).',
      docs: ['‡≤Ö‡≤°_pd', '‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤µ‡≤ø‡≤µ‡≤∞','‡≤Æ‡≤Ç‡≤°‡≤ø ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å'],
      link: 'https://enam.gov.in/web/'
    }
  },
  {
    id: 'kcc',
    name: 'Kisan Credit Card (KCC)',
    en: {
      short: 'Short-term credit to farmers for cultivation and allied activities.',
      how: 'Apply at your bank branch or via farmer-friendly portals; submit KCC application form and docs.',
      docs: ['Identity','Farm records','Income proof','Land documents (if needed)'],
      link: 'https://www.mygov.in/kisancreditcard/'
    },
    kn: {
      short: '‡≤ï‡≥É‡≤∑‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤Ç‡≤¨‡≤Ç‡≤ß‡≤ø‡≤§ ‡≤ö‡≤ü‡≥Å‡≤µ‡≤ü‡≤ø‡≤ï‡≥Ü‡≤ó‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤§‡≤æ‡≤§‡≥ç‡≤ï‡≤æ‡≤≤‡≤ø‡≤ï ‡≤∏‡≤æ‡≤≤.',
      how: '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤∂‡≤æ‡≤ñ‡≥Ü‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≤ø ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤Ü‡≤®‡≥ç‚Äå‡≤≤‡≥à‡≤®‡≥ç ‡≤Æ‡≥Ç‡≤≤‡≤ï ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø ‡≤ú‡≤Æ‡≤æ ‡≤Æ‡≤æ‡≤°‡≤ø.',
      docs: ['‡≤ó‡≥Å‡≤∞‡≥Å‡≤§‡≥Å ‡≤™‡≤°‡≤ø‡≤∏‡≥Å‡≤µ ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü',' —Ñ–µ—Ä‡≥ç‡≤Æ‡≥ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü','‡≤Ü‡≤¶‡≤æ‡≤Ø‡≤¶ ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü','‡≤≠‡≥Ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å'],
      link: 'https://www.mygov.in/kisancreditcard/'
    }
  },

  // Add a few more central schemes compactly
  {
    id: 'pmasha',
    name: 'PM-AASHA / Price Support Measures',
    en: { short:'Market intervention & MSP-related measures.', how:'Follow Ministry notifications and state procurement details.', docs:[], link:'https://dac.gov.in/' },
    kn: { short:'‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ï‡≥Ü‡≤ü‡≥ç ‡≤π‡≤∏‡≥ç‡≤§‡≤ï‡≥ç‡≤∑‡≥á‡≤™ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å MSP ‡≤∏‡≤Ç‡≤¨‡≤Ç‡≤ß‡≤ø‡≤§ ‡≤ï‡≥ç‡≤∞‡≤Æ‡≤ó‡≤≥‡≥Å.', how:'‡≤ï‡≥É‡≤∑‡≤ø ‡≤∏‡≤ö‡≤ø‡≤µ‡≤æ‡≤≤‡≤Ø‡≤¶ ‡≤Ö‡≤ß‡≤ø‡≤∏‡≥Ç‡≤ö‡≤®‡≥Ü‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≤®‡≥Å‡≤∏‡≤∞‡≤ø‡≤∏‡≤ø.', docs:[], link:'https://dac.gov.in/' }
  },
  {
    id: 'nmsa',
    name: 'NMSA (National Mission for Sustainable Agriculture)',
    en: { short:'Promote sustainable agriculture practices in rainfed areas.', how:'Contact district mission office for programs.', docs:[], link:'https://nmsa.dac.gov.in/' },
    kn: { short:'‡≤µ‡≤∞‡≥ç‡≤∑‡≤æ‡≤¨‡≥á‡≤∏‡≤ø‡≤ó‡≥ç‡≤∞‡≤π‡≤£ ‡≤™‡≥ç‡≤∞‡≤¶‡≥á‡≤∂‡≤ó‡≤≥‡≤≤‡≥ç‡≤≤‡≤ø ‡≤∏‡≤∏‡≥ç‡≤•‡≤ø‡≤∞ ‡≤ï‡≥É‡≤∑‡≤ø ‡≤™‡≥ç‡≤∞‡≤ö‡≤æ‡≤∞.', how:'‡≤ú‡≤ø‡≤≤‡≥ç‡≤≤‡≤æ ‡≤Æ‡≤ø‡≤∑‡≤®‡≥ç ‡≤ï‡≤ö‡≥á‡≤∞‡≤ø‡≤Ø‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø‡≤∞‡≤ø.', docs:[], link:'https://nmsa.dac.gov.in/' }
  },
  {
    id: 'midha',
    name: 'MIDH (Mission for Integrated Development of Horticulture)',
    en: { short:'Support for horticulture development, processing & marketing.', how:'State horticulture departments manage schemes and applications.', docs:[], link:'https://hortnet.gov.in/' },
    kn: { short:'‡≤π‡≤æ‡≤∞‡≥ç‡≤ü‡≤ø‡≤ï‡≤≤‡≥ç‡≤ö‡≤∞‡≥ç ‡≤Ö‡≤≠‡≤ø‡≤µ‡≥É‡≤¶‡≥ç‡≤ß‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ï‡≥Ü‡≤ü‡≤ø‡≤Ç‡≤ó‡≥ç ‡≤¨‡≥Ü‡≤Ç‡≤¨‡≤≤.', how:'‡≤∞‡≤æ‡≤ú‡≥ç‡≤Ø‡≤¶ ‡≤π‡≤æ‡≤∞‡≥ç‡≤ü‡≤ø‡≤ï‡≤≤‡≥ç‡≤ö‡≤∞‡≥ç ‡≤á‡≤≤‡≤æ‡≤ñ‡≥Ü‡≤ó‡≥Ü ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø.', docs:[], link:'https://hortnet.gov.in/' }
  }
];

const STATE_SCHEMES = [
  {
    id: 'rythubandhu',
    name: 'Rythu Bandhu (Telangana)',
    en: { short:'Investment support: ‚Çπ5,000 per acre per season.', how:'Based on land records; contact revenue/agriculture office.', docs:['RTC / 1B','Bank details'], link:'https://rythubandhu.telangana.gov.in/' },
    kn: { short:'‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤∏‡≥Ä‡≤∏‡≤®‡≥ç‚Äå‡≤ó‡≥Ü ‡≤™‡≥ç‡≤∞‡≤§‡≤ø ‡≤é‡≤ï‡≤∞‡≥Ü‡≤ó‡≥Ü ‚Çπ5,000 ‡≤∏‡≤π‡≤æ‡≤Ø.', how:'‡≤≠‡≥Ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü‡≤ó‡≤≥ ‡≤Ü‡≤ß‡≤æ‡≤∞‡≤¶ ‡≤Æ‡≥á‡≤≤‡≥Ü ‡≤∏‡≥á‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü; ‡≤ú‡≤ø‡≤≤‡≥ç‡≤≤‡≤æ ‡≤ï‡≤ö‡≥á‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø.', docs:['‡≤≠‡≥Ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü','‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤Æ‡≤æ‡≤π‡≤ø‡≤§‡≤ø'], link:'https://rythubandhu.telangana.gov.in/' }
  },
  {
    id: 'raithasiri',
    name: 'Raitha Siri / Raitha Bandhu (Karnataka variants)',
    en: { short:'Support packages & input subsidies for farmers.', how:'Apply via RSK / district agriculture offices or portals.', docs:['Aadhaar','land records','bank passbook'], link:'https://raitamitra.karnataka.gov.in/' },
    kn: { short:'‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø‡≤ï ‡≤™‡≥ç‡≤Ø‡≤æ‡≤ï‡≥á‡≤ú‡≥Å‡≤ó‡≤≥‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤∏‡≤¨‡≥ç‡≤∏‡≤ø‡≤°‡≤ø‡≤ó‡≤≥‡≥Å.', how:'‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø RSK / ‡≤ï‡≥É‡≤∑‡≤ø ‡≤ï‡≤ö‡≥á‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤Ç‡≤¨‡≤Ç‡≤ß‡≤ø‡≤∏‡≤ø ‡≤Ö‡≤∞‡≥ç‡≤ú‡≤ø ‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø.', docs:['‡≤Ü‡≤ß‡≤æ‡≤∞‡≥ç','‡≤≠‡≥Ç ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü','‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤™‡≥á‡≤ú‡≥ç'], link:'https://raitamitra.karnataka.gov.in/' }
  },
  {
    id: 'mahadbt',
    name: 'MahaDBT (Maharashtra portal)',
    en: { short:'One portal for state subsidies & farmer schemes.', how:'Register on MahaDBT with Aadhaar & bank details and apply.', docs:['Aadhaar','bank','scheme-specific docs'], link:'https://mahadbt.maharashtra.gov.in/' },
    kn: { short:'‡≤∞‡≤æ‡≤ú‡≥ç‡≤Ø‡≤¶ ‡≤∏‡≤¨‡≥ç‡≤∏‡≤ø‡≤°‡≤ø ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤ó‡≤≥ ‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≤≤‡≥ç.', how:'MahaDBT ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø ‡≤Æ‡≤æ‡≤°‡≤ø; ‡≤Ö‡≤∞‡≥ç‡≤ú‡≤ø ‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø.', docs:['‡≤Ü‡≤ß‡≤æ‡≤∞‡≥ç','‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç','‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü‡≤ó‡≤≥‡≥Å'], link:'https://mahadbt.maharashtra.gov.in/' }
  },
  {
    id: 'kalia',
    name: 'KALIA (Odisha)',
    en: { short:'Support for small & marginal farmers and landless households.', how:'Visit KALIA portal or local agriculture office to check eligibility & apply.', docs:['Aadhaar','bank details','family/land records'], link:'https://kalia.odisha.gov.in/' },
    kn: { short:'‡≤∏‡≤£‡≥ç‡≤£ ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å ‡≤Ö‡≤≤‡≥ç‡≤™ ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø.', how:'KALIA ‡≤™‡≥ã‡≤∞‡≥ç‡≤ü‡≤≤‡≥ç ‡≤Ö‡≤•‡≤µ‡≤æ ‡≤∏‡≥ç‡≤•‡≤≥‡≥Ä‡≤Ø ‡≤ï‡≥É‡≤∑‡≤ø ‡≤ï‡≤ö‡≥á‡≤∞‡≤ø‡≤Ø‡≥ä‡≤Ç‡≤¶‡≤ø‡≤ó‡≥Ü ‡≤∏‡≤Ç‡≤™‡≤∞‡≥ç‡≤ï‡≤ø‡≤∏‡≤ø.', docs:['‡≤Ü‡≤ß‡≤æ‡≤∞‡≥ç','‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç','‡≤≠‡≥Ç/‡≤ï‡≥Å‡≤ü‡≥Å‡≤Ç‡≤¨ ‡≤¶‡≤æ‡≤ñ‡≤≤‡≥Ü'], link:'https://kalia.odisha.gov.in/' }
  }
];


/* ======================================================
   Render schemes in DOM (left column)
   ====================================================== */
function renderSchemes(){
  const container = document.getElementById('schemesContainer');
  container.innerHTML = '';
  CENTRAL_SCHEMES.forEach(s => {
    const art = document.createElement('article');
    art.className = 'scheme';
    art.id = s.id;
    art.innerHTML = `
      <h3 data-id="${s.id}">${escapeHtml(s.name)}</h3>
      <div class="meta">${escapeHtml(s.en.short)}</div>
      <div class="row">
        <a class="link" href="${s.en.link}" target="_blank" rel="noopener">Official portal</a>
        <button class="btn" data-target="${s.id}-details">Details</button>
      </div>
      <div class="details" id="${s.id}-details"></div>
    `;
    container.appendChild(art);

    // fill details container (both languages)
    const det = art.querySelector('.details');
    det.innerHTML = `
      <div class="step"><div class="label">How to apply (EN)</div><div>${escapeHtml(s.en.how)}</div></div>
      <div class="step"><div class="label">How to apply (KN)</div><div>${escapeHtml(s.kn.how)}</div></div>
      <div class="step"><div class="label">Required documents</div><ul>${(s.en.docs||[]).map(d=>`<li>${escapeHtml(d)}</li>`).join('')}</ul></div>
      <div class="step"><a class="link" href="${s.en.link}" target="_blank">Open official page</a></div>
    `;
  });

  // state schemes
  const stateContainer = document.getElementById('stateSchemesContainer');
  stateContainer.innerHTML = '';
  STATE_SCHEMES.forEach(s => {
    const art = document.createElement('article');
    art.className = 'scheme';
    art.id = s.id;
    art.innerHTML = `
      <h3 data-id="${s.id}">${escapeHtml(s.name)}</h3>
      <div class="meta">${escapeHtml(s.en.short)}</div>
      <div class="row">
        <a class="link" href="${s.en.link}" target="_blank" rel="noopener">Official portal</a>
        <button class="btn" data-target="${s.id}-details">Details</button>
      </div>
      <div class="details" id="${s.id}-details"></div>
    `;
    stateContainer.appendChild(art);

    const det = art.querySelector('.details');
    det.innerHTML = `
      <div class="step"><div class="label">How to apply (EN)</div><div>${escapeHtml(s.en.how)}</div></div>
      <div class="step"><div class="label">How to apply (KN)</div><div>${escapeHtml(s.kn.how)}</div></div>
      <div class="step"><div class="label">Required documents</div><ul>${(s.en.docs||[]).map(d=>`<li>${escapeHtml(d)}</li>`).join('')}</ul></div>
      <div class="step"><a class="link" href="${s.en.link}" target="_blank">Open official page</a></div>
    `;
  });

  // wire up details toggle and clicking titles to ask bot
  document.querySelectorAll('button[data-target]').forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const id = btn.getAttribute('data-target'), el = document.getElementById(id);
      if(!el) return;
      // close others
      document.querySelectorAll('.details').forEach(d=>{ if(d!==el) d.style.display='none' });
      el.style.display = (el.style.display === 'block') ? 'none' : 'block';
      if(el.style.display === 'block') el.scrollIntoView({behavior:'smooth', block:'center'});
    });
  });
  // clicking scheme title asks bot
  document.querySelectorAll('.scheme h3').forEach(h=>{
    h.addEventListener('click', ()=> {
      const id = h.getAttribute('data-id');
      if(id) handleUserMessage(id);
    });
  });
}

/* ======================================================
   Chart: overview
   ====================================================== */
function countSchemes(){
  const central = CENTRAL_SCHEMES.length;
  const state = STATE_SCHEMES.length;
  const other = 0;
  return {central, state, other, total: central+state+other};
}

const ctx = document.getElementById('overviewChart').getContext('2d');
let overviewChart = new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: ['Central','State','Other'],
    datasets: [{ data: [0,0,0], backgroundColor: ['#66bb6a','#4db6ac','#a5d6a7'] }]
  },
  options: { plugins:{legend:{position:'bottom'}} }
});

function updateChart(){
  const c = countSchemes();
  overviewChart.data.datasets[0].data = [c.central, c.state, c.other];
  overviewChart.update();
}
document.getElementById('refreshCounts').addEventListener('click', ()=>{ updateChart() });
/* ======================================================
   Chatbot: offline canned answers and multilingual voice
   ====================================================== */
const chatLog = document.getElementById('chatLog');
const userMsg = document.getElementById('userMsg');
const sendBtn = document.getElementById('send');
const micBtn = document.getElementById('mic');
const botLang = document.getElementById('botLang');

// Build canned responses from data in three languages
const canned = { en: {}, hi: {}, kn: {} };

// Populate canned with scheme-based keys
function populateCanned(){
  const add = (lang, key, text) => { canned[lang][key] = text; };
  // central
  CENTRAL_SCHEMES.forEach(s=>{
    const key = s.id.toLowerCase();
    add('en', key, `${s.name}: ${s.en.short} How to apply: ${s.en.how} Official: ${s.en.link}`);
    add('kn', key, `${s.name} ‚Äî ${s.kn.short} ‡≤Ö‡≤™‡≥ç‡≤≤‡≥à ‡≤Æ‡≤æ‡≤°‡≤≤‡≥Å: ${s.kn.how} ‡≤Ö‡≤ß‡≤ø‡≤ï‡≥É‡≤§: ${s.kn.link}`);
    // a Hindi fallback could use English for now
    add('hi', key, `${s.name}: ${s.en.short} (visit ${s.en.link})`);
  });
  // state
  STATE_SCHEMES.forEach(s=>{
    const key = s.id.toLowerCase();
    add('en', key, `${s.name}: ${s.en.short} How to apply: ${s.en.how} Official: ${s.en.link}`);
    add('kn', key, `${s.name} ‚Äî ${s.kn.short} ‡≤Ö‡≤™‡≥ç‡≤≤‡≥à ‡≤Æ‡≤æ‡≤°‡≤≤‡≥Å: ${s.kn.how} ‡≤Ö‡≤ß‡≤ø‡≤ï‡≥É‡≤§: ${s.kn.link}`);
    add('hi', key, `${s.name}: ${s.en.short} (visit ${s.en.link})`);
  });
  // general keys
  add('en','pmkisan','PM-KISAN gives ‚Çπ6,000 per year to eligible farmer families. Apply at pmkisan.gov.in (Farmers Corner).');
  add('kn','pmkisan','PM-KISAN ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü ‡≤Ö‡≤°‡≤ø‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Ö‡≤∞‡≥ç‡≤π ‡≤∞‡≥à‡≤§‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤µ‡≤∞‡≥ç‡≤∑‡≤ï‡≥ç‡≤ï‡≥Ü ‚Çπ6,000 ‡≤∏‡≤ø‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü. ‡≤Ö‡≤∞‡≥ç‡≤ú‡≤ø: pmkisan.gov.in.');
  add('hi','pmkisan','PM-KISAN ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§ï‡•á ‡§§‡§π‡§§ ‡§™‡§æ‡§§‡•ç‡§∞ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‚Çπ6,000 ‡§™‡•ç‡§∞‡§§‡§ø ‡§µ‡§∞‡•ç‡§∑ ‡§Æ‡§ø‡§≤‡§§‡•á ‡§π‡•à‡§Ç‡•§ pmkisan.gov.in ‡§¶‡•á‡§ñ‡•á‡§Ç‡•§');

  add('en','pmfby','PMFBY is crop insurance that protects your crops from natural calamities and pests.');
  add('kn','pmfby','PMFBY ‡≤í‡≤Ç‡≤¶‡≥Å ‡≤¨‡≥Ü‡≤≥‡≥Ü ‡≤µ‡≤ø‡≤Æ‡≥Ü ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü ‚Äî ‡≤®‡≤∑‡≥ç‡≤ü‡≤¶ ‡≤µ‡≤ø‡≤∞‡≥Å‡≤¶‡≥ç‡≤ß ‡≤∞‡≤ï‡≥ç‡≤∑‡≤ø‡≤∏‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.');
  add('hi','pmfby','PMFBY ‡§´‡§∏‡§≤ ‡§¨‡•Ä‡§Æ‡§æ ‡§π‡•à ‡§ú‡•ã ‡§´‡§∏‡§≤ ‡§ï‡•á ‡§®‡•Å‡§ï‡§∏‡§æ‡§® ‡§∏‡•á ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§¶‡•á‡§§‡§æ ‡§π‡•à‡•§');

  add('en','kcc','KCC (Kisan Credit Card) provides timely credit. Apply via your bank.');
  add('kn','kcc','KCC ‡≤∞‡≥à‡≤§ ‡≤ï‡≥ç‡≤∞‡≥Ü‡≤°‡≤ø‡≤ü‡≥ç ‡≤ï‡≤æ‡≤∞‡≥ç‡≤°‡≥ç ‚Äî ‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤¨‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤ï‡≥ç ‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Ö‡≤∞‡≥ç‡≤ú‡≤ø ‡≤∏‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø.');
  add('hi','kcc','KCC ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•á ‡§¨‡•à‡§Ç‡§ï ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§');

  add('en','hello','Hello! Ask me about any scheme listed on the left (e.g., PM-KISAN, PMFBY, Rythu Bandhu).');
  add('kn','hello','‡≤®‡≤Æ‡≤∏‡≥ç‡≤ï‡≤æ‡≤∞! ‡≤é‡≤°‡≤≠‡≤æ‡≤ó‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø‡≤∞‡≥Å‡≤µ ‡≤Ø‡≥ã‡≤ú‡≤®‡≥Ü‡≤ó‡≤≥ ‡≤¨‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø (‡≤â‡≤¶‡≤æ: PM-KISAN, PMFBY, Rythu Bandhu).');
  add('hi','hello','‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§¨‡§æ‡§à‡§Ç ‡§ì‡§∞ ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§Ø‡•ã‡§ú‡§®‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§');
}
populateCanned();

// Utility: append message to chat log
function appendMessage(who, text){
  const d = document.createElement('div');
  d.className = 'msg ' + (who === 'user' ? 'user' : 'bot');
  d.textContent = text;
  chatLog.appendChild(d);
  chatLog.scrollTop = chatLog.scrollHeight;
}

// TTS: speak text in selected language
function speak(text, lang){
  if(!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  const map = { en: 'en-IN', hi: 'hi-IN', kn: 'kn-IN' };
  u.lang = map[lang] || 'en-IN';
  u.rate = 1;
  u.pitch = 1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

// Optionally call backend API (disabled by default)
async function callBackendAPI(message, lang){
  // if you later host a backend, put URL here
  const BACKEND_URL = ''; // e.g. 'https://your-backend.example.com/chat'
  if(!BACKEND_URL) return null;
  try{
    const res = await fetch(BACKEND_URL, {
      method: 'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ message, lang })
    });
    if(!res.ok) return null;
    const data = await res.json();
    return data.reply || null;
  }catch(e){
    console.warn('API call error', e);
    return null;
  }
}

// Handle user message (text or scheme id)
async function handleUserMessage(rawText){
  // if rawText is an id of scheme, use it
  let text = rawText || '';
  const lang = botLang.value || 'en';
  if(!text) return;
  appendMessage('user', text);
  // find keyword; prefer exact id match
  let reply = null;
  const key = (text || '').toString().toLowerCase().trim();

  // If matches an id directly
  if(canned[lang] && canned[lang][key]) reply = canned[lang][key];

  // Otherwise find if text contains any known id/name
  if(!reply){
    // check scheme ids and names
    const all = CENTRAL_SCHEMES.concat(STATE_SCHEMES);
    for(const s of all){
      if(key.includes(s.id) || key.includes(s.name.toLowerCase()) ){
        // prefer requested language mapping
        reply = (canned[lang] && canned[lang][s.id]) || (canned['en'] && canned['en'][s.id]);
        break;
      }
    }
  }

  // if still not found, check keywords (pmkisan, pmfby, kcc)
  if(!reply){
    const kwords = ['pmkisan','pm-kisan','pmfby','kcc','rythu','rythu bandhu','rythubandhu','soil','enam'];
    for(const kw of kwords){
      if(key.includes(kw)){
        reply = canned[lang][kw.replace('-','')] || canned['en'][kw.replace('-','')] || null;
        break;
      }
    }
  }

  // try backend if toggled (apiToggle controlled by button)
  const apiToggle = document.getElementById('apiToggle');
  if(!reply && apiToggle && apiToggle.classList.contains('active')){
    const apiReply = await callBackendAPI(text, lang);
    if(apiReply) reply = apiReply;
  }

  // fallback
  if(!reply){
    reply = canned[lang]['hello'] || canned['en']['hello'];
  }

  appendMessage('bot', reply);
  speak(reply, lang);
}

// Wire send button & enter key
sendBtn.addEventListener('click', ()=>{
  const t = userMsg.value.trim();
  if(!t) return;
  userMsg.value = '';
  handleUserMessage(t);
});
userMsg.addEventListener('keypress', e=>{ if(e.key === 'Enter') sendBtn.click(); });

// Speech recognition (Mic)
let recognition = null;
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.interimResults = false;
  recognition.onresult = (e)=>{
    const spoken = Array.from(e.results).map(r=>r[0].transcript).join('');
    userMsg.value = spoken;
    handleUserMessage(spoken);
  };
  recognition.onend = ()=> { micBtn.style.opacity = '1'; }
} else {
  micBtn.disabled = true;
  micBtn.title = 'Speech recognition not supported (use Chrome/Edge)';
}

micBtn.addEventListener('click', ()=>{
  if(!recognition) return alert('Speech recognition unavailable. Use Chrome/Edge.');
  const lang = botLang.value || 'en';
  recognition.lang = (lang === 'kn') ? 'kn-IN' : (lang === 'hi' ? 'hi-IN' : 'en-IN');
  micBtn.style.opacity = '0.6';
  recognition.start();
});

/* ======================================================
   Small helper and initialization
   ====================================================== */
function escapeHtml(s){ return (s||'').toString()
  .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

function init(){
  renderSchemes();
  updateChart();
  // initial greeting
  const initLang = botLang.value || 'en';
  const greet = canned[initLang] ? (canned[initLang]['hello'] || canned['en']['hello']) : canned['en']['hello'];
  appendMessage('bot', greet);
  speak(greet, initLang);
}
init();
const responses = {
  "pm-kisan": "PM-KISAN provides ‚Çπ6,000/year directly to farmers.",
  "pmfby": "Pradhan Mantri Fasal Bima Yojana gives crop insurance for farmers.",
  "rythu bandhu": "Rythu Bandhu gives ‚Çπ5,000 per acre per season in Telangana.",
};


/* allow clicking scheme titles to ask bot - already wired in renderSchemes */
</script>
</body>
</html>
